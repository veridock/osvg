<?php
// dashboard.svg - Przykładowa aplikacja SVG z PHP
header('Content-Type: image/svg+xml');

// Pobieranie metryki systemowych
$cpu_load = sys_getloadavg()[0] * 25;
$memory = memory_get_usage(true) / 1024 / 1024;
$disk_free = disk_free_space("/") / 1024 / 1024 / 1024;
$uptime = shell_exec('uptime -p');
$processes = trim(shell_exec('ps aux | wc -l'));
$temp = floatval(shell_exec('cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null')) / 1000;

// Dane dla wykresu
$data_points = [];
for($i = 0; $i < 10; $i++) {
    $data_points[] = rand(20, 80);
}
?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <!-- Gradient tła -->
        <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#000000;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#001100;stop-opacity:1" />
        </linearGradient>
        
        <!-- Gradient dla wykresów -->
        <linearGradient id="chartGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#00ff00;stop-opacity:0.8" />
            <stop offset="100%" style="stop-color:#00ff00;stop-opacity:0.2" />
        </linearGradient>
        
        <!-- Efekt świecenia -->
        <filter id="glow">
            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
            <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
            </feMerge>
        </filter>
        
        <!-- Animacja pulsowania -->
        <animate id="pulse" attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/>
    </defs>
    
    <!-- Tło -->
    <rect width="800" height="600" fill="url(#bgGradient)"/>
    
    <!-- Siatka -->
    <g stroke="#003300" stroke-width="0.5" opacity="0.3">
        <?php for($x = 0; $x <= 800; $x += 50): ?>
            <line x1="<?= $x ?>" y1="0" x2="<?= $x ?>" y2="600"/>
        <?php endfor; ?>
        <?php for($y = 0; $y <= 600; $y += 50): ?>
            <line x1="0" y1="<?= $y ?>" x2="800" y2="<?= $y ?>"/>
        <?php endfor; ?>
    </g>
    
    <!-- Tytuł -->
    <text x="400" y="40" text-anchor="middle" fill="#00ff00" font-family="monospace" 
          font-size="28" font-weight="bold" filter="url(#glow)">
        RPi System Dashboard
    </text>
    
    <!-- Data i czas -->
    <text x="400" y="65" text-anchor="middle" fill="#00ff88" font-family="monospace" font-size="14">
        <?= date('Y-m-d H:i:s') ?>
    </text>
    
    <!-- Panel CPU -->
    <g transform="translate(50, 100)">
        <rect x="0" y="0" width="160" height="120" fill="#001100" stroke="#00ff00" stroke-width="2" rx="5"/>
        <text x="80" y="25" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="16" font-weight="bold">
            CPU Load
        </text>
        
        <!-- Wykres kołowy CPU -->
        <circle cx="80" cy="70" r="30" fill="none" stroke="#003300" stroke-width="15"/>
        <circle cx="80" cy="70" r="30" fill="none" stroke="#00ff00" stroke-width="15"
                stroke-dasharray="<?= $cpu_load * 1.88 ?> 188.5" 
                stroke-dashoffset="47.125" transform="rotate(-90 80 70)"/>
        
        <text x="80" y="75" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="18" font-weight="bold">
            <?= round($cpu_load) ?>%
        </text>
    </g>
    
    <!-- Panel Memory -->
    <g transform="translate(230, 100)">
        <rect x="0" y="0" width="160" height="120" fill="#001100" stroke="#00ff00" stroke-width="2" rx="5"/>
        <text x="80" y="25" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="16" font-weight="bold">
            Memory
        </text>
        
        <!-- Bar chart pamięci -->
        <rect x="30" y="40" width="100" height="60" fill="#003300" stroke="#00ff00" stroke-width="1"/>
        <rect x="30" y="<?= 100 - ($memory/1024 * 60) ?>" width="100" height="<?= ($memory/1024 * 60) ?>" 
              fill="url(#chartGradient)">
            <animate attributeName="height" values="<?= ($memory/1024 * 60) ?>;<?= ($memory/1024 * 60) + 5 ?>;<?= ($memory/1024 * 60) ?>" 
                     dur="3s" repeatCount="indefinite"/>
        </rect>
        
        <text x="80" y="115" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="12">
            <?= round($memory) ?> MB
        </text>
    </g>
    
    <!-- Panel Disk -->
    <g transform="translate(410, 100)">
        <rect x="0" y="0" width="160" height="120" fill="#001100" stroke="#00ff00" stroke-width="2" rx="5"/>
        <text x="80" y="25" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="16" font-weight="bold">
            Disk Free
        </text>
        
        <!-- Ikona dysku -->
        <g transform="translate(40, 40)">
            <rect x="0" y="0" width="80" height="50" fill="#003300" stroke="#00ff00" stroke-width="2" rx="3"/>
            <circle cx="20" cy="25" r="8" fill="#00ff00" opacity="0.5">
                <animate attributeName="r" values="8;10;8" dur="2s" repeatCount="indefinite"/>
            </circle>
            <line x1="40" y1="15" x2="70" y2="15" stroke="#00ff00" stroke-width="2"/>
            <line x1="40" y1="25" x2="70" y2="25" stroke="#00ff00" stroke-width="2"/>
            <line x1="40" y1="35" x2="70" y2="35" stroke="#00ff00" stroke-width="2"/>
        </g>
        
        <text x="80" y="115" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="12">
            <?= round($disk_free, 1) ?> GB
        </text>
    </g>
    
    <!-- Panel Temperature -->
    <g transform="translate(590, 100)">
        <rect x="0" y="0" width="160" height="120" fill="#001100" stroke="#00ff00" stroke-width="2" rx="5"/>
        <text x="80" y="25" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="16" font-weight="bold">
            Temperature
        </text>
        
        <!-- Termometr -->
        <g transform="translate(70, 40)">
            <rect x="0" y="0" width="20" height="60" fill="#003300" stroke="#00ff00" stroke-width="2" rx="10"/>
            <rect x="2" y="<?= 60 - ($temp/100 * 60) ?>" width="16" height="<?= ($temp/100 * 60) ?>" 
                  fill="#00ff00" rx="8">
                <?php if($temp > 60): ?>
                    <animate attributeName="fill" values="#00ff00;#ff0000;#00ff00" dur="1s" repeatCount="indefinite"/>
                <?php endif; ?>
            </rect>
        </g>
        
        <text x="80" y="115" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="12">
            <?= round($temp, 1) ?>°C
        </text>
    </g>
    
    <!-- Wykres liniowy - aktywność -->
    <g transform="translate(50, 250)">
        <rect x="0" y="0" width="700" height="200" fill="#001100" stroke="#00ff00" stroke-width="2" rx="5"/>
        <text x="350" y="25" text-anchor="middle" fill="#00ff00" font-family="monospace" font-size="16" font-weight="bold">
            System Activity
        </text>
        
        <!-- Linie siatki -->
        <g stroke="#003300" stroke-width="0.5">
            <?php for($y = 40; $y <= 180; $y += 35): ?>
                <line x1="40" y1="<?= $y ?>" x2="660" y2="<?= $y ?>"/>
            <?php endfor; ?>
        </g>
        
        <!-- Wykres liniowy -->
        <polyline fill="none" stroke="#00ff00" stroke-width="2" filter="url(#glow)"
                  points="<?php 
                      foreach($data_points as $i => $val) {
                          echo (40 + $i * 66) . ',' . (180 - $val * 1.4) . ' ';
                      }
                  ?>">
            <animate attributeName="stroke-dasharray" values="0 1000;1000 0" dur="3s" repeatCount="1"/>
        </polyline>
        
        <!-- Punkty danych -->
        <?php foreach($data_points as $i => $val): ?>
            <circle cx="<?= 40 + $i * 66 ?>" cy="<?= 180 - $val * 1.4 ?>" r="4" fill="#00ff00">
                <animate attributeName="r" values="4;6;4" dur="2s" repeatCount="indefinite" 
                         begin="<?= $i * 0.2 ?>s"/>
            </circle>
        <?php endforeach; ?>
    </g>
    
    <!-- Panel informacji systemowych -->
    <g transform="translate(50, 470)">
        <rect x="0" y="0" width="700" height="100" fill="#001100" stroke="#00ff00" stroke-width="2" rx="5"/>
        
        <text x="20" y="30" fill="#00ff00" font-family="monospace" font-size="14">
            Uptime: <?= $uptime ?>
        </text>
        
        <text x="20" y="55" fill="#00ff00" font-family="monospace" font-size="14">
            Processes: <?= $processes ?>
        </text>
        
        <text x="20" y="80" fill="#00ff00" font-family="monospace" font-size="14">
            Hostname: <?= gethostname() ?>
        </text>
        
        <text x="400" y="30" fill="#00ff00" font-family="monospace" font-size="14">
            PHP Version: <?= phpversion() ?>
        </text>
        
        <text x="400" y="55" fill="#00ff00" font-family="monospace" font-size="14">
            Server: <?= $_SERVER['SERVER_SOFTWARE'] ?? 'Caddy' ?>
        </text>
        
        <text x="400" y="80" fill="#00ff00" font-family="monospace" font-size="14">
            IP: <?= $_SERVER['SERVER_ADDR'] ?? shell_exec("hostname -I | cut -d' ' -f1") ?>
        </text>
    </g>
    
    <!-- Status indicator -->
    <g transform="translate(680, 40)">
        <circle cx="0" cy="0" r="8" fill="#00ff00" filter="url(#glow)">
            <animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/>
        </circle>
        <text x="20" y="5" fill="#00ff00" font-family="monospace" font-size="12">
            ONLINE
        </text>
    </g>
    
    <!-- Refresh info -->
    <text x="400" y="590" text-anchor="middle" fill="#006600" font-family="monospace" font-size="10">
        Auto-refresh every 5 seconds
    </text>
    
    <!-- Auto refresh -->
    <script type="text/javascript">
        setTimeout(function() {
            location.reload();
        }, 5000);
    </script>
</svg>